<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Teleprompter Pro</title>

<style>

body{
margin:0;
background:black;
color:white;
font-family:Arial,Helvetica,sans-serif;
overflow:hidden;
}

video{
position:fixed;
width:100%;
height:100%;
object-fit:cover;
z-index:-1;
}

#readingZone{
position:absolute;
width:90%;
left:5%;
top:8%;
text-align:center;
overflow:hidden;
height:220px;
}

#teleprompter{
position:absolute;
width:100%;
line-height:1.4em;
font-size:38px;
font-weight:600;
text-shadow:0 0 10px black;
}

.controls{

position:fixed;
bottom:20px;
width:100%;
text-align:center;
}

button{

font-size:20px;
padding:10px 14px;
margin:4px;
border-radius:8px;
border:none;
background:#111;
color:white;

}

.rec{
background:red;
}

#sliders{

position:fixed;
right:10px;
top:100px;
background:rgba(0,0,0,.7);
padding:10px;
border-radius:10px;
display:block;

}

.sliderBlock{
margin-bottom:15px;
}

input[type=range]{
width:120px;
}

#editorBox{

position:fixed;
top:0;
width:100%;
height:180px;
background:black;
display:none;

}

textarea{

width:95%;
height:140px;
margin:10px;
font-size:20px;

}

#countdown{

position:fixed;
top:40%;
width:100%;
text-align:center;
font-size:90px;
display:none;

}

</style>

</head>

<body>

<video id="video" autoplay muted playsinline></video>

<div id="readingZone">
<div id="teleprompter"></div>
</div>

<div id="editorBox">

<textarea id="editor">

“La Isapre es más cara”…
Depende.

Si ganas 1.800.000,
tu 7% son 126.000.

Con eso puedes tener acceso
a clínicas privadas,

reembolsos en menos de 48 horas,

y beneficios adicionales.

No es más caro.
Es distinto.

Soy José Mora
Asesor Isapre Colmena

</textarea>

</div>


<div id="sliders">

<div class="sliderBlock">

Velocidad
<br>

<input id="speedSlider" type="range"
min="1" max="10" value="3">

</div>


<div class="sliderBlock">

Tamaño texto
<br>

<input id="fontSlider" type="range"
min="24" max="80" value="38">

</div>


<div class="sliderBlock">

Altura texto
<br>

<input id="heightSlider"
type="range"
min="0"
max="90"
value="8">

</div>

</div>


<div class="controls">

<button onclick="toggleEditor()">Texto</button>

<button onclick="play()">Play</button>

<button onclick="pause()">Pause</button>

<button onclick="stop()">Stop</button>

<button class="rec" onclick="startRecording()">REC</button>

</div>


<div id="countdown"></div>

<script>


let video=document.getElementById("video")

navigator.mediaDevices.getUserMedia({

video:{
width:{ideal:1280},
height:{ideal:720},
facingMode:"user"

},

audio:true

}).then(stream=>{

video.srcObject=stream
window.stream=stream

})


let tele=document.getElementById("teleprompter")

let editor=document.getElementById("editor")

let readingZone=document.getElementById("readingZone")


let speed=2

let pos=0

let playing=false

let recorder

let chunks=[]


function formatText(){

let txt=editor.value

txt=txt.replace(/\n\n/g,"\n")

tele.innerHTML=txt.replace(/\n/g,"<br>")

}


formatText()


editor.oninput=formatText


function play(){

playing=true

}


function pause(){

playing=false

}


function stop(){

playing=false
pos=0

tele.style.top="0px"

}


function loop(){

if(playing){

pos-=speed

tele.style.top=pos+"px"

}

requestAnimationFrame(loop)

}

loop()



speedSlider.oninput=e=>{

speed=parseInt(e.target.value)

saveSettings()

}


fontSlider.oninput=e=>{

tele.style.fontSize=e.target.value+"px"

saveSettings()

}


heightSlider.oninput=e=>{

readingZone.style.top=e.target.value+"%"

saveSettings()

}


function toggleEditor(){

let box=document.getElementById("editorBox")

if(box.style.display=="none")
box.style.display="block"
else
box.style.display="none"

}



function startRecording(){

document.getElementById("sliders").style.display="none"

document.querySelector(".controls").innerHTML=

'<button onclick="stopRecording()">STOP</button>'


countdown()

}



function countdown(){

let c=document.getElementById("countdown")

c.style.display="block"

let n=5

c.innerHTML=n

let i=setInterval(()=>{

n--

c.innerHTML=n

if(n==0){

clearInterval(i)

c.style.display="none"

record()

play()

}

},1000)

}



function record(){

chunks=[]

let mime=""

if(MediaRecorder.isTypeSupported("video/mp4"))
mime="video/mp4"
else
mime="video/webm"


recorder=new MediaRecorder(stream,{

mimeType:mime,
videoBitsPerSecond:5000000

})


recorder.ondataavailable=e=>{

chunks.push(e.data)

}


recorder.onstop=saveVideo

recorder.start()

}



function stopRecording(){

recorder.stop()

playing=false

document.getElementById("sliders").style.display="block"

location.reload()

}



function saveVideo(){


let mime=chunks[0].type

let ext=mime.includes("mp4")?"mp4":"webm"

let blob=new Blob(chunks,{type:mime})

let url=URL.createObjectURL(blob)


let w=window.open("")

w.document.write(`

<body style="background:black">

<video controls autoplay style="width:100%">

<source src="${url}" type="${mime}">

</video>

<br><br>

<a href="${url}" download="video.${ext}"
style="color:white;font-size:30px">

DESCARGAR VIDEO

</a>

</body>

`)

}



function saveSettings(){

localStorage.speed=speed
localStorage.font=tele.style.fontSize
localStorage.height=readingZone.style.top
localStorage.text=editor.value

}



function loadSettings(){

if(localStorage.speed)
speed=localStorage.speed

if(localStorage.font)
tele.style.fontSize=localStorage.font

if(localStorage.height)
readingZone.style.top=localStorage.height

if(localStorage.text)
editor.value=localStorage.text

formatText()

}

loadSettings()



</script>

</body>

</html>
